# CLKJ Documents Multi Company

## 模块说明

这个Odoo18模块为文档应用添加了多公司支持，实现文件级别的公司权限隔离，确保用户只能看到自己公司的文件。

## 功能特点

- **文件按公司过滤**: 根据文件所在文件夹的公司配置自动过滤文件
- **递归公司查找**: 沿着文件夹层级向上查找公司配置
- **系统文件夹保护**: 系统文件夹（如Projects、Internal等）对所有公司用户可见
- **用户文件夹隔离**: 用户创建的文件夹严格按公司权限隔离
- **自动数据维护**: 自动为新文件和现有文件设置正确的公司归属

## 安装说明

**重要**: 此模块与项目模块存在约束冲突，请按以下顺序安装：

1. **如果已安装项目模块，请先卸载项目模块**
2. **安装此文档多公司模块**  
3. **安装完成后可重新安装项目模块**

⚠️ **注意**: 必须按上述顺序操作，否则可能遇到约束验证错误。

## 工作原理

1. **隐藏的company_id字段**: 为每个文档添加计算字段，根据文件夹层级自动设置公司
2. **递归公司查找**: 如果当前文件夹没有公司配置，会向上查找父文件夹的公司设置
3. **记录规则过滤**: 使用Odoo标准的ir.rule机制实现访问控制
4. **系统文件夹识别**: 通过XML ID和文件夹名称识别系统文件夹，确保其对所有公司可见

## 技术实现

- **模型继承**: 继承`documents.document`模型添加多公司逻辑
- **计算字段**: 使用`recursive=True`的计算字段处理公司归属
- **记录规则**: 通过安全规则`[('company_id', 'in', company_ids), ('company_id', '=', False)]`实现过滤
- **数据迁移**: post_init_hook为现有文档初始化公司字段

## 依赖模块

- `documents`: Odoo文档管理模块

## 许可证

AGPL-3

## 关于OCA

OCA (Odoo Community Association) 是Odoo社区组织，致力于开发高质量的开源Odoo模块。OCA维护着数百个社区模块，为Odoo用户提供丰富的功能扩展。

本模块参考了OCA的开发规范和最佳实践，并遵循OCA的代码质量标准。

更多信息请访问：
- OCA官网: https://odoo-community.org/
- OCA GitHub: https://github.com/OCA